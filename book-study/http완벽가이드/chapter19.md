# 19. 배포 시스템

현대의 배포 도구를 이용하면 웹 콘텐츠의 생성, 배포, 관리를 더 쉽게 할 수 있다.

많은 종류의 도구가 HTTP 프로토콜을 확장하여 콘텐츠의 원격 배포 기능을 지원한다.

## 19.1 배포 지원을 위한 FrontPage 서버 확장

FrontPage(FrontPage1.0)은 다양한 기능을 제고앟는 마이크로소프트사의 웹 개발 및 배포 도구 집합이다. 1994년에 버미어 테크놀로지스에서 만들었으며 웹 사이트 관리와 제작을 모두 할 수 있는 제품이였다.

### 19.1.1 FrontPage 서버 확장

“어디서든 배포한다”라는 전략 하나로 마이크로소프트는 FrontPage 서버 확장 이라는 서버측 소프트웨어 제품군을 출시했다.

웹서버는 FPSE(FrontPage Server Extensions)에 맞춘 POST요청을 받아 처리한다. 클라이언트와 서버 사이에 방화벽과 프락시 서버가 있더라도 POST 메서드 통신만 할 수 있으면 FrontPage는 서버와 통신을 계속할 수 있다.

### 19.1.2 FrontPage 용어

- **가상서버**
  - 같은 서버에 올라가 있는 여러 웹 사이트는 각각 유일한 도메인 이름과 IP 주소를 가진다. 가상 서버를 지원하는 웹 서저를 다중 호스팅 웹 서버라 불린다.
- **루트웹**
  - 웹 서버의 최상위 콘텐츠 디렉터리 이거나 다중 호스팅 환경에서 가상 웹 서버의 최상위 콘텐츠 디렉터리이다. 루트웹에 접근하려명 페이지명을 기술하지 않고 서버의 URL만 기술하면 된다. 웹 서버에는 오직 한 개의 루트 웹만 있다.
- **서브웹**
  - 서브웹은 루트웹의 하위 디렉터리이거나 완전한 FPSE 확장 웹인 다른 서브웹의 하위 디렉터리이다.

### 19.1.3 FrontPage RPC 프로토콜

FrontPage 클라이언트와 FPSE 는 자체 RPC 프로토콜을 사용해 통신한다.

### 19.1.4 FrongPage 보안모델

직접 웹 서버 콘텐츠에 접근하는 모든 배포 시스템은 배포하는 과정에서 보안에 신경써야 한다. 대부분의 경우 FPSE의 보안은 웹 서버에 의존한다.

## 19.2 WebDAV와 공동 저작

웹 분산 저작과 버저닝(Web Distributed Authoring and Versioning, WebDAV)은 웹 배포 공동 작업에 대한 또 다른 영역을 개척했다. 현재 사용하는 협업 관련 기술 수준이 낮기 때문에 공동 저작에 적합한 플랫폼을 제공하려고 HTTP를 확장하는데 집중했다. 이는 현재 어도비, 애플, IBM, 마이크로소프트 등 여러 업체로부터 지원을 받으며 IETF와 협력관계에 있다.

### 19.2.1 WebDAV 메서드

WebDAV는 새로운 HTTP 메서드 집합을 정의하고 몇몇 HTTP 메서드의 동작 범위를 수정하였다.

- PROPFIND: 리소스의 속성을 읽는다
- PROPPATCH: 한 개 이상의 리소스에 대해 한 개 이상의 속성을 설정한다.
- MKCOL: 콜렉션을 생성한다
- COPY: 특정 원본지에서 특정 목적지로 리소스나 리소스의 집합을 복사한다. 목적지가 같은 기기에 있을 필요는 없다.
- MOVE: 특정 소스에서 특정 목적지에 리소스나 리소스의 집합을 이동시킨다. 목적지가 같은 기기에 있을 필요는 없다.
- LOCK: 하나 이상의 리소스를 잠근다.
- UNLOCK: 기존에 잠겨있는 리소스를 잠금해제 한다.

### 19.2.2 WebDAV와 XML

WebDAV 메서드는 요청과 응답 관련 정보를 헤더에 담아 전송하지만 이는 하나의 요청에 있는 여러개의 리소스나 계층 관계에 있는 리소스의 정보를 선택적으로 기술하기 어렵다. 이 문제를 해결하려 WebDAV는 XML을 지원하며 다음과 같은 용도로 사용한다.

- 데이터를 어떻게 처리할 것인지 설명하는 명령 포맷
- 서버의 복잡한 응답을 표현하는데 사용하는 포맷
- 콜렉션과 리소스를 처리하는데 사용하는 커스텀 정보 포멧
- 데이터 자체를 표현할 수 있는 유연한 포맷
- 대부분의 국제화 관련 문제에 대한 훌륭한 해결책

### 19.2.3 WebDAV 헤더

WebDAV는 새로운 메서드들의 긴으을 더 넓혀주는 여러 HTTP 헤더를 도입했다.

- DAV: WebDAV를 제공하는 서버와 통신할 때 사용함
- Depth: 여러 수준의 계층 구조로 분류된 리소스에 WebDAV를 사용하기 위한 중요한 요소이다.
- Destination: COPY나 MOVE 메서드가 목적지 URI를 식별하는데 쓰인다
- If: 정의 되어있는 상태 토큰은 lock 토큰 뿐이다. If 헤더는 조건 집합을 정의한다. 그 조건에 모두 맞지 않으면 요청은 실패한다. COPY나 PUT 같은 메서드는 If 헤더에 전제 조건을 기술해서 적용하는데 필요한 조건을 단다.
- Lock-Token: 제거되어야할 잠금(lock)을 명시하는 용도로 UNLOCK 메서드에서 사용한다. LOCK 메서드에 대한 응답은 lock 토큰에 필요한 정보를 전달하는 Lock-Token헤더를 포함한다.
- Overwrite: 대상을 덮어쓸 것인지 아닌지를 기술하는데 쓰이며 COPY나 MOVE 메서드에서 사용한다
- Timeout: 클라이언트가 필요한 타임아웃 값을 기술하는데 사용하는 요청 헤더다.

### 19.2.4 WebDAV 잠금과 덮어쓰기 방지

WebDAV는 두 가지 형식의 잠금을 지원한다.

- 리소스나 콜렉션에 대한 배타적 쓰기 잠금
  - 잠금 소유자만 쓸 수있게 보장.
- 리소스나 콜렉션에 대한 공유된 쓰기 잠금
  - 여러 사람으로 이루어져 있는 그룹이 하나의 문서에서 작업할 수 있게함

### 19.2.5 LOCK 메서드

WebDAV는 한 개의 LOCK 요청으로 여러개의 리소스를 잠글 수 있으며 WebDAV의 잠금은 클라이언트가 서버에 연결되어 있지 않아도 된다.

### 19.2.6 UNLOCK 메서드

UNLOCK 메서드는 WebDAV 리소스에 있는 잠금을 젝러한다.

다이제스트 인증을 성공적으로 완료해야하며 Lock-Token 헤더에 보내는 잠금 토큰이 맞는지 검사해야 성공적으로 완료한다.

### 19.2.7 속성과 META 데이터

속성에는 저작자의 이름, 수정한 날짜, 내용 등급 등과 같은 리소스의 정보를 기술한다. HTML의 META 태그는 콘텐츠 일부로써 그 정보들을 포함하는 메커니즘을 제공한다. 하지만 많은 리소스들을이 META에 포함될 수 없다.

WebDAV는 속성의 발견과 수정을 지원하기 위해 PROPFIND와 PROPPATCH라는 두가지 메소드를 포함하여 HTTP를 확장한다.

### 19.2.8 PROPFIND 메서드

주어진 파일이나 파일 그룹의 속성으 ㄹ읽는데 사용한다.

- 모든 속성과 그 값을 요청한다.
- 선택된 속성과 그 값의 집합을 요청한다.
- 모든 속성의 이름을 요청한다.

### 19.2.9 PROPPACH 메서드

특정 리소스의 여러 속성을 설정하거나 제거하는 원자적 메커니즘을 젲공한다. 원자성은 모든 요청이 성공하거나 모든 요청이 무효가 되거나, 둘 중 하나만 수행하는 것을 보장한다. PROPPATCH의 기본 xml요소는 `<propertyupdate>`이다. 이는 업데이트가 필요한 모든 속성을 담는 컨테이너 역할을 한다.

### 19.2.10 콜렉션과 이름공간 관리

콜렉션은 사전에 정의한 계층에 있는 리소스들의 논리적 혹은 물리적 그룹이다. WebDAV는 XML 이름 공간 메커니즘을 사용한다.

이름공간을 관리하는 다섯가지 메서드 DELETE, MKCOL, COPY, MOVE, PROPFIND를 제공한다.

### 19.2.11 MKCOL 메서드

클라이언트가 지정된 URL에 해당하는 콜렉션을 서버에 생성하게한다.

- 콜렉션을 생성할 목적으로 PUT이나 POST를 사용하면, 클라이언트는 요청에 추가적인 정보를 더해보는 식으로 자체적인 프로토콜을 만들어야한다. 그렇게 사용할 수도 있지만 즉석으로 프로토콜을 정의하는 것은 번거롭고 오류를 발생시키기 쉽다.
- 대부분의 접근 제어 메커니즘은 메서드의 타입에 기반에 동작한다. 몇가지 메서드만이 저장소에 있는 리소스를 생성하고 삭제할 수 있다.

### 19.2.12 DELETE 메서드

디렉터리를 지우려고 한다면 Depth헤더가 필요하며 응답은 지워진 콜렉션을 가리키는 Content-Location헤더를 포함한다.

### 19.2.13 COPY와 MOVE 메서드

COPY와 MOVE 메서드는 요청 URL을 원본의 위치 정보로 사용하고 목적지인 Destination HTTP 헤더의 값을 목적지 정보로 사용한다. MOVE 메서드는 COPY 메서드에 이어 몇가지 추가 작업을 수행한다. 그 작업은 원본지 URL을 목적지에 복사하고 새로 생성된 URI 무결성을 검사하고 원본을 지운다.

COPY나 MOVE가 콜렉션을 처리할 때는 Depth헤더에 영향을 받는다. Depth에 무한대 값을 기술하는 것은 MOVE 메서드에서만 할 수 있다.

### 19.2.14 향상된 HTTP/1.1 메서드

- PUT
  - If 헤더가 추가되었으며 이는 PROPPATCH, DELETE, MOVE, LOCK, UNLOCK등 다른 메서드들과 함께 사용된다.
  - 저작자가 공용 사이트에 콘텐츠를 전송하는 유일한 방법이다.
- OPTIONS
  - Class1 지원
    - 서버는 RFC 2518의 모든 절에 있는 모든 MUST 요구사항을 지원해야한다.
      만약 리소스가 Class1 수준만 지원한다면 DAV 헤더의 값으로 1을 보낼 것이다
  - Class2 지원
    - Class1 요구사항을 모두 지원하는 것에 더해 LOCK 메서드를 지원한다.
      LOCK과 함께 Class2 를 지원하려면 Timeout과 Lock-Token헤더를 지원해야하고, suppertedlock과 lockdiscovery xml요소를 지원해야한다.

### 19.2.15 WebDAV의 버전관리

수정한 것이 유실되는 문제를 완벽히 막으려면 잠금과 버저닝이 필수이다. 버저닝과 관련된 일반적인 기능 중 일부는 이전 문서의 버전을 저장하고 접근하는 것과 변경 기록과 변경에 대해 자세한 내용이 기술된 주석을 관리하는 것이다.

### 19.2.16 WebDAV의 미래

현재도 잘 지원되고있음..?
